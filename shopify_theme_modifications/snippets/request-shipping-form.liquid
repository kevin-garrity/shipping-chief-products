{{ 'update_loader_and_submit.js' | asset_url | script_tag }}
{{ 'inject_shipping_calculator.js' | asset_url | script_tag }}
{{ 'xdr.js' | asset_url | script_tag }}

<!-- These are our api overrides -->
{{ 'ajaxify-shop.js' | asset_url | script_tag }}

<!-- calculate the weight and grab us a calculator! -->
<script>

  $('#cartform').submit(function (e) {
    console.log("in click")

    if ($('#Shipping').length == 0) {
      // there are Shipping items in the cart, so proceed
      console.log("OK to checkout")
    } else {
      // there are no Shipping items so display help
      console.log("NO")
      e.preventDefault();
      $('#shipping-calculator-info p').text("Please select a destination for shipping.")


    }
  });

  $(document).ready(function() {


    // TODO a customer certainly shouldn't be able to checkout before this has happened
    $.when(remove_shipping_item()).done(function() {
      var total_weight = 0;
      var total_blanks = 0;
      {% for item in cart.items %}
        {% if item.title != "Shipping" %}
          {% if item.grams != 0 %}
            total_weight = total_weight + {{ item.grams }} * {{ item.quantity }};

          {% else %}
            total_blanks = total_blanks + 1 * {{ item.quantity }};
          {% endif %}
        {% endif %}
      {% endfor %}
      var datahash = { weight: total_weight / 1000, blanks: total_blanks };
      update_loader_and_submit("GET", datahash, function(data) { inject_shipping_calculator(data); });
    });
  });

</script>
